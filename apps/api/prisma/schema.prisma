// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

enum Status {
  PendingPayment
  PendingAdminConfirmation
  Done
  Rejected
  Expired
  Canceled
}

enum Role {
  Organizer
  Customer
}

model User {
  id              String   @id @default(uuid())
  email           String   @unique
  password        String
  full_name       String
  role            Role     @default(Customer)
  points          Int      @default(0)
  profile_picture String?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  events       Event[]
  transactions Transaction[]

  @@map("users")
}

model Event {
  id             String   @id @default(uuid())
  organizer_id   String
  organizer      User     @relation(fields: [organizer_id], references: [id])
  category_id    String
  category       Category @relation(fields: [category_id], references: [id])
  location_id    String
  location       Location @relation(fields: [location_id], references: [id])
  title          String
  start_date     DateTime
  end_date       DateTime
  description    String
  average_rating Int?
  picture        String?
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  ticket_types TicketType[]
  promotions   Promotion[]
  review       Review[]

  @@map("events")
}

model Category {
  id         String   @id @default(uuid())
  label      String   @unique
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  events Event[]

  @@map("categories")
}

model Location {
  id         String   @id @default(uuid())
  label      String   @unique
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  events Event[]

  @@map("locations")
}

model TicketType {
  id              String   @id @default(uuid())
  event_id        String
  event           Event    @relation(fields: [event_id], references: [id])
  title           String
  price           Int
  available_seats Int
  start_date      DateTime
  end_date        DateTime
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@map("ticket_types")
}

model Promotion {
  id         String   @id @default(uuid())
  event_id   String
  event      Event    @relation(fields: [event_id], references: [id])
  code       String
  amount     Int
  start_date DateTime
  end_date   DateTime
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("promotions")
}

model Review {
  id             String   @id @default(uuid())
  customer_id    String
  transaction_id String
  event_id       String
  event          Event    @relation(fields: [event_id], references: [id])
  rating         Int
  description    String
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@map("reviews")
}

model Transaction {
  id                     String   @id @default(uuid())
  customer_id            String
  customer               User     @relation(fields: [customer_id], references: [id])
  ticket_type_id         String
  quantity               Int
  status                 Status   @default(PendingPayment)
  payment_proof          String?
  payment_proof_deadline DateTime
  acceptance_deadline    DateTime
  points_used            Int
  promotion_used         String?
  created_at             DateTime @default(now())
  updated_at             DateTime @updatedAt

  @@map("transactions")
}
